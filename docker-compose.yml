version: '3.8'

services:
  cine-platform:
    build: .
    container_name: cine-platform
    restart: unless-stopped
    ports:
      - "5000:5000"
    environment:
      - FLASK_HOST=0.0.0.0
      - FLASK_PORT=5000
      # Conexión interna a PocketBase (nombre del servicio:puerto interno)
      - POCKETBASE_URL=http://pocketbase:8090
      - MOVIES_FOLDER=/data/movies
      - SECRET_KEY=${SECRET_KEY:-clave_secreta_por_defecto_docker}
    volumes:
      - ./uploads:/app/uploads
      - ./temp:/app/temp
      - ./outputs:/app/outputs
      - ./logs:/app/logs
      # Mapeo de la carpeta real de películas. 
      # IMPORTANTE: Se requiere permiso de escritura para generar thumbnails.
      - /media/d/audiovisual:/data/movies
    depends_on:
      - pocketbase

  pocketbase:
    image: ghcr.io/muchobien/pocketbase:latest
    container_name: pocketbase
    restart: unless-stopped
    # Mapea puerto host 8070 -> contenedor 8090
    ports:
      - "8070:8090"
    volumes:
      - pb_data:/pb_data
    command:
      - --http=0.0.0.0:8090

volumes:
  pb_data: