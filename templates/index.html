<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
    <title>Pel√≠culas - Cine Platform</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/menu.css') }}">
    <script src="{{ url_for('static', filename='js/script.js') }}?v={{ range(1, 10000) | random }}" defer></script>
</head>
<body class="dark-mode">

    <!-- Bot√≥n hamburguesa para m√≥vil -->
    <button class="menu-toggle" onclick="toggleMenu()" aria-label="Abrir men√∫">‚ò∞</button>
    
    <!-- Overlay para m√≥vil -->
    <div class="menu-overlay" onclick="toggleMenu()" aria-hidden="true"></div>

    <!-- Men√∫ lateral colapsable -->
    <div class="side-menu" id="sideMenu" role="navigation" aria-label="Men√∫ principal">
        <!-- Bot√≥n para colapsar/expandir (solo visible en PC) -->
        <div class="menu-collapse-btn" onclick="toggleCollapse()" title="Colapsar men√∫" role="button" aria-label="Colapsar men√∫">‚óÄ</div>
        
        <div class="menu-header">
            <!-- T√≠tulo completo (visible cuando NO est√° colapsado) -->
            <h2 class="menu-title-full">Cine<span>Platform</span></h2>
        </div>
        
        <div class="menu-user">
            <div class="menu-user-email">{{ session['user_email'] }}</div>
            <div class="menu-user-role">{{ session['user_role'] }}</div>
        </div>
        
        <div class="menu-items">
            <!-- Secci√≥n principal -->
            <div class="menu-section-title">PRINCIPAL</div>
            <a href="#" class="menu-item active" onclick="showTab('movies'); return false;" data-tab="movies" role="tab" aria-selected="true">
                <span aria-hidden="true">üé¨</span> 
                <span class="menu-item-text">Pel√≠culas</span>
            </a>
            <a href="#" class="menu-item" onclick="showTab('series'); return false;" data-tab="series" role="tab" aria-selected="false">
                <span aria-hidden="true">üì∫</span> 
                <span class="menu-item-text">Series</span>
            </a>
            
            <!-- Secci√≥n admin (solo visible para admin) -->
            {% if session['user_role'] == 'admin' %}
            <div class="menu-section-title">ADMINISTRACI√ìN</div>
            <a href="/admin/manage" class="menu-item">
                <span aria-hidden="true">‚öôÔ∏è</span> 
                <span class="menu-item-text">Panel Admin</span>
            </a>
            <a href="/optimizer" class="menu-item">
                <span aria-hidden="true">üé•</span> 
                <span class="menu-item-text">Optimizador</span>
            </a>
            {% endif %}
        </div>
        
        <!-- Cerrar sesi√≥n al final -->
        <a href="/logout" class="menu-logout">
            <span aria-hidden="true">üö™</span> 
            <span class="menu-logout-text">Cerrar Sesi√≥n</span>
        </a>
    </div>

    <!-- Contenido principal -->
    <main class="main-content" id="mainContent" role="main">
        <!-- Tabs ocultos (por compatibilidad) -->
        <div class="tabs" style="display: none;">
            <a id="moviesTab" class="tab-link active" onclick="showTab('movies')">Pel√≠culas</a>
            <a id="seriesTab" class="tab-link" onclick="showTab('series')">Series</a>
        </div>

        <!-- Secci√≥n de Pel√≠culas -->
        <section id="movies" class="tab-content" style="display: block;" role="tabpanel" aria-labelledby="moviesTab">
            <h2>Pel√≠culas</h2>
            {% if movies %}
            <div class="card-container">
                {% for movie in movies %}
                <article class="card">
                    <img src="{{ movie.thumbnail }}" alt="{{ movie.name }}" loading="lazy">
                    <a href="/play/{{ movie.path }}" class="card-link">{{ movie.name }}</a>
                </article>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <p>No hay pel√≠culas disponibles</p>
            </div>
            {% endif %}
        </section>

        <!-- Secci√≥n de Series -->
        <section id="series" class="tab-content" style="display: none;" role="tabpanel" aria-labelledby="seriesTab">
            <h2>Series</h2>
            {% if series %}
                {% for series_name, episodes in series.items() %}
                <div class="series-section">
                    <h3 class="collapsible-header" onclick="toggleSeries(this)" role="button" aria-expanded="false">
                        {{ series_name }}
                    </h3>
                    <div class="card-container collapsible-content" style="display: none;">
                        {% for episode in episodes %}
                        <article class="card">
                            <img src="{{ episode.thumbnail }}" alt="{{ episode.name }}" loading="lazy">
                            <a href="/play/{{ episode.path }}" class="card-link">{{ episode.name }}</a>
                        </article>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
            <div class="empty-state">
                <p>No hay series disponibles</p>
            </div>
            {% endif %}
        </section>
    </main>

    <!-- Script para inicializaci√≥n adicional (muy poco, solo lo esencial) -->
    <script>
        // Peque√±o script para asegurar que el t√≠tulo se actualiza al cargar
        document.addEventListener('DOMContentLoaded', function() {
            // Asegurar que la pesta√±a activa sea movies
            const activeTab = document.querySelector('.menu-item.active');
            if (!activeTab || activeTab.getAttribute('data-tab') !== 'movies') {
                // Si no hay active o no es movies, forzar movies
                window.showTab('movies');
            }
        });
    </script>
</body>
</html>