<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
    <title>Cine Platform</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <!-- Estilos principales -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main/main.css') }}?v={{ range(1, 10000) | random }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/menu/menu.css') }}?v={{ range(1, 10000) | random }}">
</head>

<body class="dark-mode">

    <!-- BotÃ³n hamburguesa para mÃ³vil -->
    <button class="menu-toggle" onclick="toggleMenu()" aria-label="Abrir menÃº">â˜°</button>
    
    <!-- Overlay para mÃ³vil -->
    <div class="menu-overlay" onclick="toggleMenu()" aria-hidden="true"></div>

    <!-- MenÃº lateral colapsable -->
    <div class="side-menu" id="sideMenu" role="navigation" aria-label="MenÃº principal">

        <!-- BotÃ³n para colapsar/expandir (solo PC) -->
        <div class="menu-collapse-btn" onclick="toggleCollapse()" title="Colapsar menÃº" role="button" aria-label="Colapsar menÃº">â—€</div>
        
        <div class="menu-header">
            <h2 class="menu-title-full">Cine<span>Platform</span></h2>
        </div>
        
        <div class="menu-user">
            <div class="menu-user-email">{{ session['user_email'] }}</div>
            <div class="menu-user-role">{{ session['user_role'] }}</div>
        </div>
        
        <div class="menu-items">
            <div class="menu-section-title">PRINCIPAL</div>

            <a href="#" class="menu-item active" onclick="showTab('movies'); return false;" data-tab="movies" role="tab" aria-selected="true">
                <span aria-hidden="true">ğŸ¬</span> 
                <span class="menu-item-text">PelÃ­culas</span>
            </a>

            <a href="#" class="menu-item" onclick="showTab('series'); return false;" data-tab="series" role="tab" aria-selected="false">
                <span aria-hidden="true">ğŸ“º</span> 
                <span class="menu-item-text">Series</span>
            </a>
            
            {% if session['user_role'] == 'admin' %}
            <div class="menu-section-title">ADMINISTRACIÃ“N</div>

            <a href="/admin/manage" class="menu-item">
                <span aria-hidden="true">âš™ï¸</span> 
                <span class="menu-item-text">Panel Admin</span>
            </a>

            <a href="/optimizer" class="menu-item">
                <span aria-hidden="true">ğŸ¥</span> 
                <span class="menu-item-text">Optimizador</span>
            </a>
            {% endif %}
        </div>
        
        <a href="/logout" class="menu-logout">
            <span aria-hidden="true">ğŸšª</span> 
            <span class="menu-logout-text">Cerrar SesiÃ³n</span>
        </a>
    </div>
    
    <div id="thumbnail-progress" style="display: none; position: fixed; bottom: 20px; right: 20px; background: var(--bg-secondary); padding: 10px; border-radius: var(--border-radius); border-left: 4px solid var(--accent-color); z-index: 1000;">
        <span>Generando miniaturas: <span id="thumbnail-count">0</span> pendientes</span>
    </div>

    <!-- Contenido principal -->
    <main class="main-content" id="mainContent" role="main">

        <!-- Tabs ocultos (compatibilidad) -->
        <div class="tabs" style="display: none;">
            <a id="moviesTab" class="tab-link active" onclick="showTab('movies')">PelÃ­culas</a>
            <a id="seriesTab" class="tab-link" onclick="showTab('series')">Series</a>
        </div>

        <!-- ========================= -->
        <!--      SECCIÃ“N PELÃCULAS    -->
        <!-- ========================= -->
        <section id="movies" class="tab-content" style="display: block;" role="tabpanel" aria-labelledby="moviesTab">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px;">
                <h2 style="border-left: 6px solid var(--accent-color); padding-left: 15px; margin-bottom: 0;">PelÃ­culas</h2>
                <button onclick="window.refreshContent()" class="refresh-btn" title="Refrescar catÃ¡logo">
                    ğŸ”„
                </button>
            </div>

            <!-- El JS insertarÃ¡ aquÃ­ las categorÃ­as en carruseles -->
            <div id="moviesContainer" class="categories-container"></div>
        </section>

        <!-- ========================= -->
        <!--        SECCIÃ“N SERIES     -->
        <!-- ========================= -->
        <section id="series" class="tab-content" style="display: none;" role="tabpanel" aria-labelledby="seriesTab">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px;">
                <h2 style="border-left: 6px solid var(--accent-color); padding-left: 15px; margin-bottom: 0;">Series</h2>
                <button onclick="window.refreshContent()" class="refresh-btn" title="Refrescar catÃ¡logo">
                    ğŸ”„
                </button>
            </div>

            <!-- El JS insertarÃ¡ aquÃ­ las series en carruseles -->
            <div id="seriesContainer"></div>
        </section>

    </main>

    <!-- Cargar mÃ³dulos en orden -->
    <script src="{{ url_for('static', filename='js/main/cache.js') }}?v={{ range(1, 10000) | random }}" defer></script>
    <script src="{{ url_for('static', filename='js/main/thumbnailManager.js') }}?v={{ range(1, 10000) | random }}" defer></script>
    <script src="{{ url_for('static', filename='js/main/categoryUtils.js') }}?v={{ range(1, 10000) | random }}" defer></script>
    <script src="{{ url_for('static', filename='js/main/cardCreators.js') }}?v={{ range(1, 10000) | random }}" defer></script>
    <script src="{{ url_for('static', filename='js/main/carousel.js') }}?v={{ range(1, 10000) | random }}" defer></script>
    <script src="{{ url_for('static', filename='js/main/tabs.js') }}?v={{ range(1, 10000) | random }}" defer></script>
    <script src="{{ url_for('static', filename='js/main/menu.js') }}?v={{ range(1, 10000) | random }}" defer></script>
    <script src="{{ url_for('static', filename='js/main/utils.js') }}?v={{ range(1, 10000) | random }}" defer></script>
    <script src="{{ url_for('static', filename='js/main/api.js') }}?v={{ range(1, 10000) | random }}" defer></script>
    <script src="{{ url_for('static', filename='js/main/init.js') }}?v={{ range(1, 10000) | random }}" defer></script>
</body>
</html>