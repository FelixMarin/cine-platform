<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Optimizador de Videos - Cine Platform</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/optimizer.css') }}"/>
  <style>
    .back-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: #007bff;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      text-decoration: none;
      font-weight: 600;
      z-index: 1000;
    }
    .back-btn:hover {
      background: #0056b3;
      color: white;
      text-decoration: none;
    }
  </style>
</head>
<body>
<a href="/" class="back-btn">â† Volver al inicio</a>

<div class="container mt-5">
	<h1 class="text-center mb-4" style="font-weight:700; color:#343a40;">
	  ğŸ¬ Pipeline de OptimizaciÃ³n de Videos
	</h1>

  <!-- Formulario de subida directa -->
	<div class="card shadow-sm mb-4">
	  <div class="card-body">
		<h5 class="card-title">ğŸ“¤ Subir archivo de video</h5>
		<form id="upload-form">
		  <label for="video-input" class="custom-file-upload">
			<i class="fas fa-file-upload"></i> Elegir archivo
		  </label>
		  <input type="file" id="video-input" name="video" accept=".mkv,.mp4,.avi,.mov,.flv,.wmv" required style="display:none" />
		  <button type="submit" id="upload-btn" class="btn btn-success ml-2">Subir</button>
		</form>
		<div id="video-preview-container" class="mt-3 text-center" style="display:none;">
		  <h6 class="text-muted">Vista previa:</h6>
		  <video id="video-preview" controls class="shadow-sm rounded" style="max-width: 100%; max-height: 250px;"></video>
		</div>
		<div id="upload-status" class="mt-3" style="display:none;">
		  <span class="spinner"></span>
		  <span id="status-text">Preparando subidaâ€¦</span>
		  <div class="progress-bar"><div></div></div>
		  <span id="upload-percent">0%</span>
		</div>
	  </div>
	</div>

	<div class="card shadow-sm mb-4">
	  <div class="card-body">
		<h5 class="card-title">ğŸ› ï¸ Estado del Pipeline</h5>
		<div id="pipelineSteps" class="d-flex flex-wrap">
		  <div id="step1" class="pipeline-step inactive">Reparar Archivo</div>
		  <div id="step2" class="pipeline-step inactive">Reducir TamaÃ±o</div>
		  <div id="step3" class="pipeline-step inactive">Optimizar Video</div>
		  <div id="step4" class="pipeline-step inactive">Validar DuraciÃ³n</div>
		</div>
	  </div>
	</div>
	
	<div class="card shadow-sm mb-4" id="estado-procesamiento">
	  <div class="card-body">
		<div class="d-flex justify-content-between align-items-center">
		  <h5 class="mb-0">ğŸ“ˆ Estado de procesamiento</h5>
		  <span id="statusIcon" style="font-size:1.5em;">ğŸŸ¢</span>
		</div>
		<p class="mt-2 mb-1"><strong>Archivo en proceso:</strong> <span id="currentFile">Ninguno</span></p>

		<table class="table table-sm table-bordered text-center mt-3">
		  <thead class="thead-light">
			<tr>
			  <th>Frames</th>
			  <th>FPS</th>
			  <th>DuraciÃ³n</th>
			  <th>Bitrate</th>
			  <th>Velocidad</th>
			</tr>
		  </thead>
		  <tbody>
			<tr>
			  <td id="stat-frames">â€“</td>
			  <td id="stat-fps">â€“</td>
			  <td id="stat-time">â€“</td>
			  <td id="stat-bitrate">â€“</td>
			  <td id="stat-speed">â€“</td>
			</tr>
		  </tbody>
		</table>
		
		<div class="mt-3">
		  <h6 class="text-muted">ğŸ¬ InformaciÃ³n del vÃ­deo original</h6>
			<table class="table table-sm table-striped table-bordered mt-2">
			  <thead class="thead-light">
				<tr><th>Campo</th><th>Valor</th></tr>
			  </thead>
			  <tbody>
				<tr><td>Nombre</td><td id="info-name">â€“</td></tr>
				<tr><td>DuraciÃ³n</td><td id="info-duration">â€“</td></tr>
				<tr><td>ResoluciÃ³n</td><td id="info-resolution">â€“</td></tr>
				<tr><td>Formato</td><td id="info-format">â€“</td></tr>
				<tr><td>Codec vÃ­deo</td><td id="info-vcodec">â€“</td></tr>
				<tr><td>Codec audio</td><td id="info-acodec">â€“</td></tr>
				<tr><td>TamaÃ±o</td><td id="info-size">â€“</td></tr>
			  </tbody>
			</table>
		</div>
	  </div>
	</div>

	<div class="card shadow-sm mb-4">
	  <div class="card-body">
		<h5 class="card-title">ğŸ“š Historial de Procesamiento</h5>
		<table class="table table-hover">
		  <thead class="thead-dark">
			<tr>
				<th>Nombre del Video</th>
				<th>Estado</th>
				<th>Fecha/Hora Fin</th>
				<th>DuraciÃ³n Proceso</th>
			</tr>
		  </thead>
		  <tbody id="history"></tbody>
		</table>
	  </div>
	</div>

</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="{{ url_for('static', filename='js/optimizer.js') }}"></script>
</body> 
</html>
